(function(t){function e(e){for(var r,n,i=e[0],u=e[1],l=e[2],p=0,m=[];p<i.length;p++)n=i[p],Object.prototype.hasOwnProperty.call(a,n)&&a[n]&&m.push(a[n][0]),a[n]=0;for(r in u)Object.prototype.hasOwnProperty.call(u,r)&&(t[r]=u[r]);c&&c(e);while(m.length)m.shift()();return o.push.apply(o,l||[]),s()}function s(){for(var t,e=0;e<o.length;e++){for(var s=o[e],r=!0,i=1;i<s.length;i++){var u=s[i];0!==a[u]&&(r=!1)}r&&(o.splice(e--,1),t=n(n.s=s[0]))}return t}var r={},a={app:0},o=[];function n(e){if(r[e])return r[e].exports;var s=r[e]={i:e,l:!1,exports:{}};return t[e].call(s.exports,s,s.exports,n),s.l=!0,s.exports}n.m=t,n.c=r,n.d=function(t,e,s){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},n.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(n.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)n.d(s,r,function(e){return t[e]}.bind(null,r));return s},n.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="/";var i=window["webpackJsonp"]=window["webpackJsonp"]||[],u=i.push.bind(i);i.push=e,i=i.slice();for(var l=0;l<i.length;l++)e(i[l]);var c=u;o.push([0,"chunk-vendors"]),s()})({0:function(t,e,s){t.exports=s("56d7")},"56d7":function(t,e,s){"use strict";s.r(e);var r=s("2b0e"),a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{attrs:{id:"app"}},[t.auth.isAuth?t._e():s("auth",{attrs:{auth:t.auth}}),t.auth.isAuth?s("profile",{attrs:{auth:t.auth}}):t._e(),s("users-list",{attrs:{auth:t.auth}})],1)},o=[],n=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("b-container",{attrs:{fluid:"",id:"user-list"}},[s("table",{staticClass:"table mt-3"},[t.users?s("tbody",t._l(t.users,(function(e){return t.auth.isAuth&&t.auth.user.public_id==e.public_id?t._e():s("tr",{key:e.public_id},[s("td",[t._v(t._s(e.username))]),s("td",[t._v(t._s(e.email))]),t.auth.isAuth?s("td",[t.followed&&!t.followed.includes(e.public_id)?s("a",{attrs:{href:"#"},on:{click:function(s){return s.preventDefault(),t.Follow(e.public_id)}}},[t._v(" Follow ")]):t._e(),t.followed&&t.followed.includes(e.public_id)?s("a",{attrs:{href:"#"},on:{click:function(s){return s.preventDefault(),t.Unfollow(e.public_id)}}},[t._v(" Unfollow ")]):t._e()]):t._e()])})),0):t._e()]),t.pagination.pages?s("ul",{staticClass:"pagination"},t._l(t.pagination.pages,(function(e){return s("li",{key:e,staticClass:"page-item",class:{active:e==t.pagination.page}},[s("a",{staticClass:"page-link",attrs:{href:"#"},on:{click:function(s){return s.preventDefault(),t.getList(e)}}},[t._v(" "+t._s(e)+" ")])])})),0):t._e()])},i=[],u={name:"UsersList",data(){return{users:null,pagination:{page:null,pages:null}}},props:["auth"],computed:{followed(){let t=this.$store.getters["auth/getProfile"],e=null;return t&&(e=t.followed.map(t=>t.public_id)),e}},methods:{getList(t){this.$api.get("list/"+t).then(e=>{this.users=e.data.users,this.pagination.page=t,this.pagination.pages=e.data.pages}).catch(t=>{console.log(t.response.data)})},followedInfo(){this.$store.dispatch("auth/profile")},Follow(t){this.$api.post("/follow/"+t,{},{headers:{"x-access-token":""+this.auth.user.token}}).then(t=>{this.followedInfo()}).catch(t=>{console.log(t.response.data)})},Unfollow(t){this.$api.post("/unfollow/"+t,{},{headers:{"x-access-token":""+this.auth.user.token}}).then(t=>{this.followedInfo()}).catch(t=>{console.log(t.response.data)})}},created(){this.users||this.getList(1),this.auth.isAuth&&!this.followed&&this.followedInfo()}},l=u,c=s("2877"),p=Object(c["a"])(l,n,i,!1,null,"0b65f9cb",null),m=p.exports,f=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("b-navbar",{attrs:{type:"light",variant:"light",id:"user-account"}},["signIn"===t.mode?s("b-form",{attrs:{inline:""},on:{submit:function(e){return e.preventDefault(),t.signIn(e)}}},[s("b-form-input",{staticClass:"mb-2 mr-sm-2 mb-sm-0",attrs:{type:"text",placeholder:"username"},model:{value:t.form.username,callback:function(e){t.$set(t.form,"username",e)},expression:"form.username"}}),s("b-form-input",{staticClass:"mb-2 mr-sm-2 mb-sm-0",attrs:{type:"password",placeholder:"password"},model:{value:t.form.password,callback:function(e){t.$set(t.form,"password",e)},expression:"form.password"}}),s("b-button",{staticClass:"mb-2 mr-sm-2 mb-sm-0",attrs:{type:"submit"}},[t._v("Войти")])],1):t._e(),"signUp"===t.mode?s("b-form",{attrs:{inline:""},on:{submit:function(e){return e.preventDefault(),t.signUp(e)}}},[s("b-form-input",{staticClass:"mb-2 mr-sm-2 mb-sm-0",attrs:{type:"text",placeholder:"username"},model:{value:t.form.username,callback:function(e){t.$set(t.form,"username",e)},expression:"form.username"}}),s("b-form-input",{staticClass:"mb-2 mr-sm-2 mb-sm-0",attrs:{type:"text",placeholder:"email"},model:{value:t.form.email,callback:function(e){t.$set(t.form,"email",e)},expression:"form.email"}}),s("b-form-input",{staticClass:"mb-2 mr-sm-2 mb-sm-0",attrs:{type:"password",placeholder:"password"},model:{value:t.form.password,callback:function(e){t.$set(t.form,"password",e)},expression:"form.password"}}),s("b-button",{staticClass:"mb-2 mr-sm-2 mb-sm-0",attrs:{type:"submit"}},[t._v("Регистрация")])],1):t._e(),s("b-link",{on:{click:function(e){e.preventDefault(),t.mode=t.isSignInForm?"signUp":"signIn"}}},[t._v(" "+t._s(t.isSignInForm?"Регистрация":"Вход")+" ")])],1)},h=[],d={name:"Auth",data(){return{mode:"signIn",form:{username:"",email:"",password:""}}},props:["auth"],computed:{isSignInForm(){return"signIn"===this.mode}},methods:{signIn(){this.$store.dispatch("auth/login",{username:this.form.username,password:this.form.password})},signUp(){this.$store.dispatch("auth/register",{username:this.form.username,email:this.form.email,password:this.form.password})}}},b=d,g=Object(c["a"])(b,f,h,!1,null,"fc1c5abc",null),v=g.exports,_=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{attrs:{id:"user-info"}},[s("b-navbar",{attrs:{type:"light",variant:"light"}},[s("b-form",{attrs:{inline:""},on:{submit:function(e){return e.preventDefault(),t.userUpdate(e)}}},[s("b-form-input",{staticClass:"mb-2 mr-sm-2 mb-sm-0",attrs:{type:"text",placeholder:t.auth.user.username},model:{value:t.form.username,callback:function(e){t.$set(t.form,"username",e)},expression:"form.username"}}),s("b-form-input",{staticClass:"mb-2 mr-sm-2 mb-sm-0",attrs:{type:"password",placeholder:"password"},model:{value:t.form.password,callback:function(e){t.$set(t.form,"password",e)},expression:"form.password"}}),s("b-button",{staticClass:"mb-2 mr-sm-2 mb-sm-0",attrs:{type:"submit"}},[t._v("Обновить")])],1),s("b-button",{staticClass:"mb-2 mr-sm-2 mb-sm-0",attrs:{variant:"danger"},on:{click:function(e){return e.preventDefault(),t.userRemove(e)}}},[t._v("Удалить")]),s("div",[s("a",{attrs:{href:"#"},on:{click:function(e){return e.preventDefault(),t.Logout(e)}}},[t._v("Выход")])])],1),t.info?s("b-container",{attrs:{fluid:""}},[s("span",[t._v(t._s(t.auth.user.username)+" followed: ")]),t._l(t.info.followed,(function(e,r){return s("span",[s("span",[t._v(t._s(e.username))]),r+1!=t.info.followed.length?s("span",[t._v(", ")]):t._e()])}))],2):t._e()],1)},w=[],y={name:"Profile",data(){return{form:{username:"",password:""}}},props:["auth"],computed:{info(){return this.$store.getters["auth/getProfile"]}},methods:{userUpdate(){this.$api.put("/update/"+this.auth.user.public_id,this.form,{headers:{"x-access-token":""+this.auth.user.token}}).then(t=>{this.$store.dispatch("auth/refresh",t.data)}).catch(t=>{console.log(t.response.data)})},userRemove(){this.$api.delete("/delete/"+this.auth.user.public_id,{headers:{"x-access-token":""+this.auth.user.token}}).then(t=>{this.$store.dispatch("auth/logout")}).catch(t=>{console.log(t.response.data)})},userInfo(){this.$store.dispatch("auth/profile")},Logout(){this.$store.dispatch("auth/logout")}},mounted(){this.info||this.userInfo()}},k=y,$=Object(c["a"])(k,_,w,!1,null,"1caeb396",null),x=$.exports,I={components:{Profile:x,Auth:v,UsersList:m},computed:{auth(){let t=this.$store.getters["auth/getUser"],e=this.$store.getters["auth/isAuth"];return{user:t,isAuth:e}}}},O=I,S=Object(c["a"])(O,a,o,!1,null,null,null),C=S.exports,P=s("2f62"),j=s("bc3a"),U=s.n(j),A={namespaced:!0,state:{user:JSON.parse(localStorage.getItem("user"))||"",profile:null},mutations:{auth(t,e){e.token;t.user=e,localStorage.setItem("user",JSON.stringify(e))},unauth(t){t.user="",t.profile="",localStorage.removeItem("user")},sync(t,e){t.user.username=e.username,t.profile.username=e.username,localStorage.setItem("user",JSON.stringify(t.user))},extra(t,e){t.profile=e}},actions:{login({commit:t},e){return new Promise((s,r)=>{this._vm.$api.get("auth",{auth:e}).then(e=>{t("auth",e.data),s(e)}).catch(t=>{console.log(t.response.data),r(t)})}).catch(t=>{})},register({commit:t},e){return new Promise((t,s)=>{this._vm.$api.post("create",e).then(s=>{this.dispatch("auth/login",e),t(s)}).catch(t=>{console.log(t.response.data),s(t)})}).catch(t=>{})},refresh({commit:t},e){t("sync",e)},logout({commit:t}){t("unauth")},profile({commit:t,state:e}){return new Promise((s,r)=>{this._vm.$api.get("/get/"+e.user.public_id,{headers:{"x-access-token":""+e.user.token}}).then(e=>{t("extra",e.data.user),s(e)}).catch(t=>{console.log(t.response.data),r(t)})}).catch(t=>{})}},getters:{isAuth:t=>!!t.user.token,getUser:t=>t.user,getProfile:t=>t.profile}};r["default"].use(P["a"]);var D=new P["a"].Store({modules:{auth:A}});const L=U.a.create({baseURL:"http://127.0.0.1:5000/",headers:{accept:"application/json"}});var F=L,J={install(t){t.prototype.$api=F}},E=s("5f5b");s("f9e3"),s("2dd8");r["default"].config.productionTip=!1,r["default"].use(E["a"]),r["default"].use(J),new r["default"]({render:function(t){return t(C)},store:D}).$mount("#app")}});
//# sourceMappingURL=app.a97608fa.js.map